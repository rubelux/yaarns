<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
     <title>Shaker App Example</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: true,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
   </head> 

     <div class="header"><h1 class="heading"><a href="#">
          <span>Shaker</span></a></h1>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../">Mojito Documentation</a>
        &#160;&#160;::&#160;&#160;
        <a href="index.html" title="Shaker">Shaker</a>
        &#160;&#160;::&#160;&#160;
        
           <a href="shaker_api_summary.html">Shaker Configuration API</a>
        &#160;&#160;::&#160;&#160;
        
        
           <a href="shaker_faq.html">FAQ</a>
        
        </p>

      </div>
      <div class="content">
   <div class="section" id="shaker-app-example">
<h1>Shaker App Example<a class="headerlink" href="#shaker-app-example" title="Permalink to this headline">¶</a></h1>
<p>To better understand how Shaker works, we are going to create a simple application that
will cover the basic features and some advanced configuration as well.</p>
<p>You can also look at <a class="reference external" href="https://github.com/dferreiroval/mojito-shaker-demos">this simple application</a>
to learn how to install Shaker. <a class="reference external" href="https://github.com/dferreiroval/mojito-shaker-demos">https://github.com/dferreiroval/mojito-shaker-demos</a></p>
<div class="section" id="application-overview">
<span id="shaker-app-ex-overview"></span><h2>Application Overview<a class="headerlink" href="#application-overview" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/example_app.png"><img alt="_images/example_app.png" class="align-right" src="_images/example_app.png" style="width: 700px;" /></a>
<p>Our application will have three main mojits:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">master</span></tt> - the &#8220;parent mojit&#8221;, which will be the placeholder for the other mojits</li>
<li><tt class="docutils literal"><span class="pre">primary</span></tt> - the mojit creating the left part of our application.</li>
<li><tt class="docutils literal"><span class="pre">secondary</span></tt> - the mojit creating the right part of our application.</li>
</ul>
<p>Each mojit will react to a specific set of dimensions:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">device</span></tt>: default, iphone</li>
<li><tt class="docutils literal"><span class="pre">region</span></tt>:  default, CA</li>
<li><tt class="docutils literal"><span class="pre">skin</span></tt>: default, gray, blue</li>
</ul>
<p>Thus, if we are on a mobile device, we might load different CSS. Similarly, we may
load different assets according to skin and/or region. Shaker will handle all the possible
combinations.</p>
</div>
<div class="section" id="application-structure">
<span id="shaker-app-ex-app-structure"></span><h2>Application Structure<a class="headerlink" href="#application-structure" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will analyze each piece of our application.</p>
<div class="section" id="master-mojit">
<span id="app-structure-master-mojit"></span><h3>master mojit<a class="headerlink" href="#master-mojit" title="Permalink to this headline">¶</a></h3>
<p>This mojit will be the placeholder for the other two mojits. Let&#8217;s take a look at the
controller and the view:</p>
<p><strong>controller.common.js:</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">index</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">primary</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
                <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;index&#39;</span>
            <span class="p">},</span>
            <span class="nx">secondary</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;secondary&#39;</span><span class="p">,</span>
                <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;index&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">ac</span><span class="p">.</span><span class="nx">composite</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">meta</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">},</span>

<span class="nx">dynamic</span><span class="o">:</span><span class="p">{</span>
    <span class="nx">ac</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="s1">&#39;AJAX entry point!&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, we are not manually including any CSS, and we don&#8217;t have any logic in our
controller. Shaker takes care of this at runtime based on the current context.
Note that we have another controller action, which will be used by the binder (explained
in the next paragraph).</p>
<p><strong>index.mu.html:</strong></p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;doc&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;head&quot;</span> <span class="na">class=</span><span class="s">&quot;clearfix&quot;</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main&quot;</span> <span class="na">class=</span><span class="s">&quot;clearfix&quot;</span><span class="nt">&gt;</span>
    {{{primary}}}
    {{{secondary}}}
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>Also <tt class="docutils literal"><span class="pre">master</span></tt> will react to various dimensions (<tt class="docutils literal"><span class="pre">skin:grey</span></tt>, <tt class="docutils literal"><span class="pre">device:iphone</span></tt>), so
this is how the asset structure looks:</p>
<div class="highlight-text"><div class="highlight"><pre>master/
   /assets/
        master.css
        master.iphone.css
        myskin.grey.css
        myskin.blue.css
</pre></div>
</div>
<p>Note that there is a special dimension called <tt class="docutils literal"><span class="pre">common</span></tt>, which basically acts as a CSS-base,
sharing its CSS among with other dimensions. The <tt class="docutils literal"><span class="pre">master.iphone.css</span></tt> or
<tt class="docutils literal"><span class="pre">skin.grey.css</span></tt> files will have some style overriding the baseplate style.</p>
</div>
<div class="section" id="primary-mojit">
<span id="app-structure-primary-mojit"></span><h3>primary mojit<a class="headerlink" href="#primary-mojit" title="Permalink to this headline">¶</a></h3>
<p>This mojit will be the left part of our application (see the image above).
We are not going to show the controller or view because neither contain anything
more than the HTML template and some dummy data to populate it. What
is important to Shaker are the assets contained in the mojit. In this case, the
mojit is sensitive to <tt class="docutils literal"><span class="pre">region</span></tt> and <tt class="docutils literal"><span class="pre">skin</span></tt>:</p>
<p><strong>Assets structure</strong></p>
<div class="highlight-text"><div class="highlight"><pre>primary/assets/
  primary.css
  region.ca.css
  primary-skin.grey.css
  primary-skin.blue.css
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The names of the files don&#8217;t matter. Only the folder structure is important.</p>
</div>
<p>This mojit will contain a binder, which will be deployed to the client to extend
communication from a different entry point.</p>
<p><strong>Binder: index.js</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">bind</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Y</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;#call&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_executeInvoke</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
<span class="p">},</span>

<span class="nx">_executeInvoke</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">mojitProxy</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;dynamic&#39;</span><span class="p">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resultInvoke</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
<span class="p">},</span>

<span class="nx">resultInvoke</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Note that no request have been made at this point.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We are including this binder so you can see how Shaker is doing the rollups with all the
client-side dependencies (if <tt class="docutils literal"><span class="pre">deploy</span></tt> is set to <tt class="docutils literal"><span class="pre">true</span></tt>).</p>
</div>
<div class="section" id="secondary-mojit">
<span id="app-structure-secondary-mojit"></span><h3>secondary mojit<a class="headerlink" href="#secondary-mojit" title="Permalink to this headline">¶</a></h3>
<p>This mojit will be the right part of our application. This mojit reacts to all the
previous dimensions:</p>
<div class="highlight-text"><div class="highlight"><pre>secondary/assets/
  secondary.css
  secondary.iphone.css
  secondary-region.ca.css
  secondary-skin.grey.css
  secondary-skin.blue.css
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The names of the files don&#8217;t matter. Only the folder structure is important.</p>
</div>
</div>
<div class="section" id="htmlframemojit">
<span id="app-structure-htmlframemojit"></span><h3>HTMLFrameMojit<a class="headerlink" href="#htmlframemojit" title="Permalink to this headline">¶</a></h3>
<p>Mojito uses an &#8220;HTMLFrame&#8221; to create the skeleton of the HTML document and to embed all
your executed mojits (See <a class="reference external" href="http://developer.yahoo.com/cocktails/mojito/docs/code_exs/htmlframe_view.html">Using the HTML Frame Mojit</a>).
Shaker will need to be executed within this HTMLFrame, so basically we create a copy of
the original HTMLFrame and add the little pieces we need:</p>
<p><strong>ShakerHTMLFrame controller.server.js</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">...</span>
 <span class="nx">__call</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
   <span class="c1">// If we are deploying to the client get all the assets required</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;deploy&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">ac</span><span class="p">.</span><span class="nx">deploy</span><span class="p">.</span><span class="nx">constructMojitoClientRuntime</span><span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">assets</span><span class="p">,</span>
                      <span class="nx">meta</span><span class="p">.</span><span class="nx">binders</span><span class="p">);</span>
              <span class="p">}</span>
<span class="hll">              <span class="nx">ac</span><span class="p">.</span><span class="nx">shaker</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span>
</span>
              <span class="c1">// Attach assets found in the &quot;meta&quot; to the page</span>
              <span class="nx">Y</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">assets</span><span class="p">.</span><span class="nx">getAssets</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">types</span><span class="p">,</span> <span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
              <span class="p">...</span>
      <span class="p">}</span>
      <span class="p">...</span>

 <span class="p">},</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">requires</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;mojito-assets-addon&#39;</span><span class="p">,</span>
  <span class="s1">&#39;mojito-deploy-addon&#39;</span><span class="p">,</span>
<span class="hll">  <span class="s1">&#39;mojito-config-addon&#39;</span><span class="p">,</span>
</span>  <span class="s1">&#39;mojito-shaker-addon&#39;</span>
<span class="p">]});</span>
</pre></div>
</div>
<p>We need Shaker to execute after analyzing all the dependencies if the application is
deployed to the client and before the assets get passed to the template.</p>
</div>
<div class="section" id="application-configuration">
<span id="app-structure-app-config"></span><h3>Application Configuration<a class="headerlink" href="#application-configuration" title="Permalink to this headline">¶</a></h3>
<p>We need to tell Shaker how we want to do the rollups. To do that, we have to
create a <tt class="docutils literal"><span class="pre">shaker</span></tt> object with the correct configuration in <tt class="docutils literal"><span class="pre">application.json</span></tt>.</p>
<p><strong>Example &#8216;shaker&#8217; object in application.json</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="p">[{</span>
<span class="hll">    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;//&quot;</span><span class="o">:</span> <span class="s2">&quot;we set out ShakerHTMLFrame as main mojit&quot;</span>
    <span class="s2">&quot;//&quot;</span><span class="o">:</span> <span class="k">this</span> <span class="nx">configuration</span> <span class="nx">is</span> <span class="nx">shared</span> <span class="nx">to</span> <span class="nx">all</span> <span class="nx">context</span>
    <span class="s2">&quot;specs&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;htmlframe&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;ShakerHTMLFrameMojit&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;deploy&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Shaker Demo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;child&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;master&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="hll">    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;environment:test&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;shaker&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;task&quot;</span><span class="o">:</span> <span class="s2">&quot;local&quot;</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="hll">    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;device:iphone&quot;</span><span class="p">],</span>
</span>    <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="s2">&quot;iphone&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;region:CA&quot;</span><span class="p">],</span>
    <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="s2">&quot;ca&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;skin:blue&quot;</span><span class="p">],</span>
    <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="s2">&quot;blue&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;skin:grey&quot;</span><span class="p">],</span>
    <span class="s2">&quot;selector&quot;</span><span class="o">:</span> <span class="s2">&quot;grey&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
    <span class="s2">&quot;settings&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;environment:stage&quot;</span><span class="p">],</span>

<span class="hll">    <span class="s2">&quot;shaker&quot;</span><span class="o">:</span> <span class="p">{</span>
</span>        <span class="s2">&quot;task&quot;</span><span class="o">:</span> <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;images&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s2">&quot;parallel&quot;</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;delay&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;myAmazonKey&quot;</span><span class="p">,</span>
                <span class="s2">&quot;secret&quot;</span><span class="o">:</span> <span class="s2">&quot;myAmazonSecret&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bucket&quot;</span><span class="o">:</span> <span class="s2">&quot;shaker&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>We define a different configuration for each environment. For example, in the basic
one (<tt class="docutils literal"><span class="pre">[&quot;master&quot;]</span></tt>), we don&#8217;t have any configuration, so Shaker is going to assume that
we are in &#8220;developer mode&#8221; which means Shaker won&#8217;t do any rollups at all. It&#8217;s just going
to include the files one by one. On the other hand, if we are in <tt class="docutils literal"><span class="pre">[stage]</span></tt>, Shaker will
do the rollups and upload them to the Amazon CDN (see
<a class="reference external" href="shaker_usage.html#environment-configuration">Deployment Configuration</a>  for more
information). In the next section, we will see exactly what gets deployed in
each particular case.</p>
</div>
</div>
<div class="section" id="shaker-running-on-our-application">
<span id="shaker-app-ex-running"></span><h2>Shaker Running on Our Application<a class="headerlink" href="#shaker-running-on-our-application" title="Permalink to this headline">¶</a></h2>
<p>Now that we understand the internals of our application, let&#8217;s see how it behaves at
build time and at runtime.</p>
<div class="section" id="build-time">
<span id="running-build-time"></span><h3>Build Time<a class="headerlink" href="#build-time" title="Permalink to this headline">¶</a></h3>
<p>To run shaker, execute the <tt class="docutils literal"><span class="pre">shaker</span></tt> command: <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">shake</span></tt></p>
<dl class="docutils">
<dt>Shaker accepts the following commands:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">--context</span></tt> - Specify the context environment that Shaker use.</li>
<li><tt class="docutils literal"><span class="pre">--run</span></tt> - After Shaker executes, it will run the server (exactly as <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">start</span></tt>).</li>
</ul>
</dd>
</dl>
<p>If you don&#8217;t specify a context, Shaker will run picking the default
configuration (<tt class="docutils literal"><span class="pre">[master]</span></tt>).</p>
<p>Let&#8217;s assume that we run <tt class="docutils literal"><span class="pre">mojito</span> <span class="pre">shake</span> <span class="pre">--context</span> <span class="pre">&quot;environment:test&quot;</span> <span class="pre">--run</span></tt>. This will
make Shaker generate local rollups and then start the server. Shaker will take the
following steps:</p>
<ol class="arabic simple">
<li>It will analyze all your application files, looking for mojits, and within mojits,
the autoloads, assets, binders, views, etc.</li>
<li>It will compute all the dependencies for binders, all the dimensions for assets, and
generate metadata information.</li>
<li>It will take the previous metadata, concatenate, minify, and write the rollups either
locally or to the CDN.</li>
<li>It will write the metadata file as a compiled autoload, which will contain all the
generated rollup paths. This file will be used automatically at runtime.</li>
</ol>
<p>Everything revolves around the metadata file shown below:</p>
<p><strong>Example: shaker-meta.js</strong></p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">YUI</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;shaker/metaMojits&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Y</span><span class="p">,</span> <span class="nx">NAME</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">YUI</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s2">&quot;_mojito._cache.shaker&quot;</span><span class="p">);</span>
<span class="hll"><span class="nx">YUI</span><span class="p">.</span><span class="nx">_mojito</span><span class="p">.</span><span class="nx">_cache</span><span class="p">.</span><span class="nx">shaker</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span>
</span><span class="p">{</span>
  <span class="s2">&quot;mojits&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="hll">    <span class="s2">&quot;master&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="s2">&quot;*&quot;</span><span class="o">:</span> <span class="p">{</span>
</span>        <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;css&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/master_default_c75fe0cbaaf623aea7be93e50b7f3c7f.css&quot;</span><span class="p">],</span>
            <span class="s2">&quot;js&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/master_89d0110765d6c92d517b3bab39407c9a.client.js&quot;</span><span class="p">],</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;primary&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;*&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;index&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;css&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/primary_index_9eee7d6bfbc2d41a0d57ae90ff40f61a.css&quot;</span><span class="p">],</span>
          <span class="s2">&quot;js&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/static/demo/assets/compiled/primary_d3d36e4c5173cb91aae507cf5ecb2ef8.client.js&quot;</span><span class="p">],</span>
<span class="hll">        <span class="p">}</span>
</span><span class="hll">      <span class="p">}</span>
</span>    <span class="p">},</span>
    <span class="p">...</span>
  <span class="s2">&quot;core&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;/static/demo/assets/compiled/core_54287af0374120fd75a3d7251d66eb90.common.js&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;images&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">...</span>
  <span class="p">],</span>
  <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}});</span>
</pre></div>
</div>
<p>As you can see for each mojit and for each possible combination, Shaker generated a rollup.
Shaker signs the rollup with MD5 to avoid committing the same file twice. Moreover, Shaker
generates the Mojito core rollup for you and also all the client side rollup (if your
application is configured in <tt class="docutils literal"><span class="pre">application.json</span></tt> to be deployed to the client with
<tt class="docutils literal"><span class="pre">deploy:true</span></tt>).</p>
<p>During development, you may want to know what exactly gets included in every rollup. To do
that, just run <tt class="docutils literal"><span class="pre">shaker</span></tt> in development mode: <tt class="docutils literal"><span class="pre">mojit</span> <span class="pre">shake</span></tt></p>
<p>You can see which files will be picked up for each dimension combination and also which
files will be picked up on the client side.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, every mojit will require two requests: one for the CSS rollup, and
another for all the JS. You could improve the number of requests by bundling
mojits together. It&#8217;s what we call &#8220;High coverage mojits&#8221;. For more information,
see <a class="reference external" href="./shaker_usage.html">Shaker: Usage</a>.</p>
</div>
</div>
<div class="section" id="runtime">
<span id="running-run-time"></span><h3>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h3>
<p>At runtime, the normal workflow happens in Mojito until the execution reaches the
ShakerHTMLFrame. Then, our Shaker addon gets executed, examines the context, determines
which dimensions match the request, and serves the most appropriate rollup to the client.
So, if the context of a request is set to <tt class="docutils literal"><span class="pre">region:CA</span></tt> and <tt class="docutils literal"><span class="pre">device:iphone</span></tt>, Shaker will
select the rollup for those dimensions and attach it to the page.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To create custom dimensions (not built in a mojit), you will have to set the value
of that dimension at runtime. In this example, &#8220;skin&#8221; is picked from the URL and
passed to the context, so Shaker knows which value to use.</p>
</div>
<p>Shaker also allows you to bundle CSS rollups at the application level. In this example, we
have some boilerplate CSS that belongs to the application level and gets shared among all
mojits.</p>
</div>
</div>
</div>

   </div>
